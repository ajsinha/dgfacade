<!DOCTYPE html>
<!--
  ~ Copyright © 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Proprietary and confidential. Patent Pending.
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Broker Configuration')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{fragments/layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active">Broker Configuration</li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-lg-11 mx-auto">
                <h1 class="display-5 mb-4"><i class="fas fa-server me-3 text-success"></i>Broker Configuration</h1>

                <p class="lead">Brokers are external message systems that DGFacade connects to for data retrieval.
                Each broker is defined by a JSON file in a configurable directory, making it easy to add, modify, or remove broker connections without code changes.</p>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Convention:</strong> The JSON filename (minus <code>.json</code>) becomes the broker's logical name.
                    For example, <code>config/brokers/prod-kafka.json</code> creates a broker named <strong>prod-kafka</strong>
                    that channels can reference.
                </div>

                <!-- How It Works -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-folder-open me-2"></i>How It Works</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered mb-0">
                            <thead class="table-light">
                                <tr><th>Aspect</th><th>Detail</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><strong>Config Directory</strong></td><td>Default: <code>config/brokers/</code> &mdash; configurable via <code>dgfacade.brokers.config-dir</code> in <code>application.properties</code></td></tr>
                                <tr><td><strong>File Format</strong></td><td>JSON with <code>.json</code> extension. One file per broker.</td></tr>
                                <tr><td><strong>Naming</strong></td><td>Filename = broker name. <code>prod-kafka.json</code> → broker <code>prod-kafka</code></td></tr>
                                <tr><td><strong>Discovery</strong></td><td>All <code>*.json</code> files in the directory are loaded at startup. Invalid files are skipped with error logging.</td></tr>
                                <tr><td><strong>Supported Types</strong></td><td><code>kafka</code>, <code>activemq</code>, <code>rabbitmq</code>, <code>ibmmq</code>, <code>filesystem</code>, <code>sql</code></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Application Properties -->
                <div class="card mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-cog me-2"></i>Application Properties</h5></div>
                    <div class="card-body">
<pre class="bg-dark text-light p-3 rounded"><code># Broker configuration directory (default: config/brokers)
dgfacade.brokers.config-dir=config/brokers

# Connection timeout for all brokers (ms)
dgfacade.brokers.connection-timeout=30000

# Reconnection attempts on failure
dgfacade.brokers.max-reconnect-attempts=10

# Reconnection backoff (ms)
dgfacade.brokers.reconnect-backoff-ms=1000</code></pre>
                    </div>
                </div>

                <!-- JSON Schema -->
                <div class="card mb-4">
                    <div class="card-header" style="background-color: #10b981; color: white;">
                        <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>JSON Schema</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><code>type</code></td><td>string</td><td><span class="badge bg-danger">Yes</span></td><td>Broker type: <code>kafka</code>, <code>activemq</code>, <code>rabbitmq</code>, <code>ibmmq</code></td></tr>
                                <tr><td><code>description</code></td><td>string</td><td>No</td><td>Human-readable description for documentation</td></tr>
                                <tr><td><code>enabled</code></td><td>boolean</td><td>No</td><td>Enable/disable this broker (default: <code>true</code>)</td></tr>
                                <tr><td><code>connection</code></td><td>object</td><td><span class="badge bg-danger">Yes</span></td><td>Connection parameters (varies by type)</td></tr>
                                <tr><td><code>ssl</code></td><td>object</td><td>No</td><td>SSL/TLS configuration (JKS/PKCS12 or PEM)</td></tr>
                                <tr><td><code>authentication</code></td><td>object</td><td>No</td><td>SASL / username-password authentication</td></tr>
                                <tr><td><code>properties</code></td><td>object</td><td>No</td><td>Additional vendor-specific properties passed through</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ════════════════════ KAFKA ════════════════════ -->
                <div class="card mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-stream me-2"></i>Kafka Broker &mdash; <code>config/brokers/prod-kafka.json</code></h5></div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#kafka-basic">Basic</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#kafka-ssl-jks">SSL (JKS)</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#kafka-ssl-pem"><i class="fas fa-certificate me-1"></i>SSL (PEM)</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#kafka-sasl">SASL_SSL</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#kafka-mtls-pem"><i class="fas fa-shield-alt me-1"></i>mTLS (PEM)</a></li>
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane fade show active" id="kafka-basic">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "kafka",
  "description": "Production Kafka cluster",
  "enabled": true,
  "connection": {
    "bootstrap_servers": "kafka-1:9092,kafka-2:9092,kafka-3:9092",
    "client_id": "dgfacade-prod",
    "group_id": "dgfacade-consumer-group",
    "auto_offset_reset": "latest",
    "max_poll_records": 500
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="kafka-ssl-jks">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "kafka",
  "description": "Kafka with SSL (JKS keystore)",
  "connection": {
    "bootstrap_servers": "kafka-1:9093,kafka-2:9093",
    "client_id": "dgfacade-prod"
  },
  "ssl": {
    "enabled": true,
    "format": "JKS",
    "protocol": "TLSv1.3",
    "keystore_path": "/opt/certs/kafka-keystore.jks",
    "keystore_password": "changeit",
    "keystore_type": "JKS",
    "truststore_path": "/opt/certs/kafka-truststore.jks",
    "truststore_password": "changeit",
    "truststore_type": "JKS"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="kafka-ssl-pem">
<div class="alert alert-success mb-3"><i class="fas fa-leaf me-2"></i><strong>Cloud-Native:</strong> PEM files are the industry standard for Kubernetes, AWS MSK, Confluent Cloud, and cert-manager deployments.</div>
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "kafka",
  "description": "Kafka with SSL using PEM certificates",
  "connection": {
    "bootstrap_servers": "kafka-1:9093,kafka-2:9093,kafka-3:9093",
    "client_id": "dgfacade-prod",
    "group_id": "dgfacade-consumer-group"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "ca_cert_path": "/opt/certs/ca-chain.pem",
    "client_cert_path": "/opt/certs/client.crt",
    "client_key_path": "/opt/certs/client.key"
  }
}</code></pre>
<p class="text-muted mt-2 small"><strong>Files:</strong> <code>ca-chain.pem</code> = CA root + intermediate concatenated, <code>client.crt</code> = client certificate, <code>client.key</code> = PKCS#8 or PKCS#1 private key.</p>
                            </div>
                            <div class="tab-pane fade" id="kafka-sasl">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "kafka",
  "description": "Kafka with SASL_SSL (SCRAM-SHA-512)",
  "connection": {
    "bootstrap_servers": "kafka-1:9094,kafka-2:9094",
    "client_id": "dgfacade-prod",
    "group_id": "dgfacade-consumer-group"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "ca_cert_path": "/opt/certs/ca-chain.pem"
  },
  "authentication": {
    "mechanism": "SASL_SSL",
    "sasl_mechanism": "SCRAM-SHA-512",
    "username": "dgfacade-user",
    "password": "secret"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="kafka-mtls-pem">
<div class="alert alert-warning mb-3"><i class="fas fa-shield-alt me-2"></i><strong>Mutual TLS (mTLS):</strong> Both client and server present certificates. Common in zero-trust and service-mesh architectures.</div>
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "kafka",
  "description": "Kafka mTLS with full PEM cert chain",
  "connection": {
    "bootstrap_servers": "kafka-1:9093,kafka-2:9093,kafka-3:9093",
    "client_id": "dgfacade-mtls-prod",
    "group_id": "dgfacade-consumer-group"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",

    "ca_cert_path":     "/opt/certs/ca-bundle.pem",
    "client_cert_path": "/opt/certs/dgfacade-client-fullchain.pem",
    "client_key_path":  "/opt/certs/dgfacade-client.key"
  }
}</code></pre>
<div class="card bg-light mt-3">
    <div class="card-body">
        <h6><i class="fas fa-file-alt me-2"></i>PEM File Structure</h6>
<pre class="mb-0 small"><code><strong>ca-bundle.pem</strong> (CA chain — root + intermediates concatenated):
┌─────────────────────────────────────────┐
│ -----BEGIN CERTIFICATE-----             │  ← Intermediate CA
│ MIIFjTCCA3WgAwIBAgIUZ2...              │
│ -----END CERTIFICATE-----               │
│ -----BEGIN CERTIFICATE-----             │  ← Root CA
│ MIIFYDCCBEigAwIBAgIQQ...               │
│ -----END CERTIFICATE-----               │
└─────────────────────────────────────────┘

<strong>dgfacade-client-fullchain.pem</strong> (client cert + issuing CA):
┌─────────────────────────────────────────┐
│ -----BEGIN CERTIFICATE-----             │  ← Client cert
│ MIIEpDCCAoygAwIBAgIU...                │
│ -----END CERTIFICATE-----               │
│ -----BEGIN CERTIFICATE-----             │  ← Issuing intermediate CA
│ MIIFjTCCA3WgAwIBAgIU...                │
│ -----END CERTIFICATE-----               │
└─────────────────────────────────────────┘

<strong>dgfacade-client.key</strong> (private key — PKCS#8 or RSA PKCS#1):
┌─────────────────────────────────────────┐
│ -----BEGIN PRIVATE KEY-----             │  ← PKCS#8 (preferred)
│ MIIEvgIBADANBgkqhkiG9w0...            │
│ -----END PRIVATE KEY-----               │
└─────────────────────────────────────────┘
  OR
┌─────────────────────────────────────────┐
│ -----BEGIN RSA PRIVATE KEY-----         │  ← PKCS#1 (also supported)
│ MIIEowIBAAKCAQEA0Z1K...               │
│ -----END RSA PRIVATE KEY-----           │
└─────────────────────────────────────────┘
  OR
┌─────────────────────────────────────────┐
│ -----BEGIN EC PRIVATE KEY-----          │  ← EC key (also supported)
│ MHQCAQEEIODk14FG7Gnz...               │
│ -----END EC PRIVATE KEY-----            │
└─────────────────────────────────────────┘</code></pre>
    </div>
</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ════════════════════ ACTIVEMQ ════════════════════ -->
                <div class="card mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-envelope me-2"></i>ActiveMQ Broker &mdash; <code>config/brokers/prod-activemq.json</code></h5></div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#amq-basic">Basic</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#amq-ssl-jks">SSL (JKS)</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#amq-ssl-pem"><i class="fas fa-certificate me-1"></i>SSL (PEM)</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#amq-failover">Failover</a></li>
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane fade show active" id="amq-basic">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "activemq",
  "description": "Production ActiveMQ broker",
  "connection": {
    "broker_url": "tcp://activemq-host:61616",
    "username": "admin",
    "password": "admin123",
    "client_id": "dgfacade-amq-prod"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="amq-ssl-jks">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "activemq",
  "description": "ActiveMQ with SSL (JKS)",
  "connection": {
    "broker_url": "ssl://activemq-host:61617",
    "username": "admin",
    "password": "admin123"
  },
  "ssl": {
    "enabled": true,
    "format": "JKS",
    "keystore_path": "/opt/certs/amq-keystore.jks",
    "keystore_password": "changeit",
    "truststore_path": "/opt/certs/amq-truststore.jks",
    "truststore_password": "changeit"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="amq-ssl-pem">
<div class="alert alert-success mb-3"><i class="fas fa-leaf me-2"></i><strong>PEM Mode:</strong> Use <code>"format": "PEM"</code> with raw <code>.pem</code> / <code>.crt</code> / <code>.key</code> files. No keytool or JKS conversion needed.</div>
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "activemq",
  "description": "ActiveMQ with SSL using PEM cert chain",
  "connection": {
    "broker_url": "ssl://activemq-host:61617",
    "username": "admin",
    "password": "admin123"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "ca_cert_path":     "/opt/certs/ca-chain.pem",
    "client_cert_path": "/opt/certs/amq-client.crt",
    "client_key_path":  "/opt/certs/amq-client.key"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="amq-failover">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "activemq",
  "description": "ActiveMQ with failover and PEM SSL",
  "connection": {
    "broker_url": "failover:(ssl://amq-1:61617,ssl://amq-2:61617)?randomize=true",
    "username": "admin",
    "password": "admin123"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "ca_cert_path": "/opt/certs/ca-chain.pem"
  }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ════════════════════ RABBITMQ ════════════════════ -->
                <div class="card mb-4">
                    <div class="card-header" style="background: linear-gradient(135deg, #ff6600 0%, #cc5200 100%); color: white;">
                        <h5 class="mb-0"><i class="fas fa-paper-plane me-2"></i>RabbitMQ Broker &mdash; <code>config/brokers/prod-rabbitmq.json</code></h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#rmq-basic">Basic</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#rmq-ssl-jks">SSL (JKS)</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#rmq-ssl-pem"><i class="fas fa-certificate me-1"></i>SSL (PEM)</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#rmq-mtls-pem"><i class="fas fa-shield-alt me-1"></i>mTLS (PEM)</a></li>
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane fade show active" id="rmq-basic">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "rabbitmq",
  "description": "Production RabbitMQ cluster",
  "connection": {
    "host": "rabbitmq-host",
    "port": 5672,
    "virtual_host": "/production",
    "username": "dgfacade",
    "password": "secret",
    "connection_timeout": 30000,
    "heartbeat": 60,
    "exchange": "dgfacade.exchange",
    "exchange_type": "topic",
    "prefetch_count": 100
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="rmq-ssl-jks">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "rabbitmq",
  "description": "RabbitMQ with SSL (JKS)",
  "connection": {
    "host": "rabbitmq-host",
    "port": 5671,
    "virtual_host": "/production",
    "username": "dgfacade",
    "password": "secret"
  },
  "ssl": {
    "enabled": true,
    "format": "JKS",
    "protocol": "TLSv1.3",
    "truststore_path": "/opt/certs/rabbit-truststore.jks",
    "truststore_password": "changeit"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="rmq-ssl-pem">
<div class="alert alert-success mb-3"><i class="fas fa-leaf me-2"></i><strong>PEM Mode:</strong> Use CA certificate chain directly &mdash; no JKS conversion.</div>
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "rabbitmq",
  "description": "RabbitMQ with PEM CA certificate",
  "connection": {
    "host": "rabbitmq-host",
    "port": 5671,
    "virtual_host": "/production",
    "username": "dgfacade",
    "password": "secret"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "ca_cert_path": "/opt/certs/rabbitmq-ca-chain.pem"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="rmq-mtls-pem">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "rabbitmq",
  "description": "RabbitMQ mTLS with PEM client cert + CA chain",
  "connection": {
    "host": "rabbitmq-host",
    "port": 5671,
    "virtual_host": "/production",
    "username": "dgfacade",
    "password": "secret"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "ca_cert_path":     "/opt/certs/rabbitmq-ca-bundle.pem",
    "client_cert_path": "/opt/certs/dgfacade-rabbit-client.crt",
    "client_key_path":  "/opt/certs/dgfacade-rabbit-client.key"
  }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ════════════════════ IBM MQ ════════════════════ -->
                <div class="card mb-4">
                    <div class="card-header" style="background: linear-gradient(135deg, #054ada 0%, #033296 100%); color: white;">
                        <h5 class="mb-0"><i class="fas fa-industry me-2"></i>IBM MQ Broker &mdash; <code>config/brokers/prod-ibmmq.json</code></h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#ibm-basic">Basic</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#ibm-ssl-jks">SSL (JKS)</a></li>
                            <li class="nav-item"><a class="nav-link text-danger fw-bold" data-bs-toggle="tab" href="#ibm-ssl-pem"><i class="fas fa-certificate me-1"></i>SSL (PEM)</a></li>
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane fade show active" id="ibm-basic">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "ibmmq",
  "description": "Production IBM MQ queue manager",
  "connection": {
    "host": "ibmmq-host",
    "port": 1414,
    "queue_manager": "QM_PROD",
    "channel": "DGFACADE.SVRCONN",
    "username": "dgfacade",
    "password": "secret",
    "ccsid": 1208,
    "transport_type": "client"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="ibm-ssl-jks">
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "ibmmq",
  "description": "IBM MQ with SSL (JKS)",
  "connection": {
    "host": "ibmmq-host",
    "port": 1414,
    "queue_manager": "QM_PROD",
    "channel": "DGFACADE.SVRCONN",
    "username": "dgfacade",
    "password": "secret"
  },
  "ssl": {
    "enabled": true,
    "format": "JKS",
    "cipher_suite": "TLS_AES_256_GCM_SHA384",
    "keystore_path": "/opt/certs/ibmmq-keystore.jks",
    "keystore_password": "changeit",
    "truststore_path": "/opt/certs/ibmmq-truststore.jks",
    "truststore_password": "changeit"
  }
}</code></pre>
                            </div>
                            <div class="tab-pane fade" id="ibm-ssl-pem">
<div class="alert alert-info mb-3"><i class="fas fa-info-circle me-2"></i><strong>IBM MQ + PEM:</strong> The <code>SslHelper</code> loads PEM files into an in-memory keystore and sets the default <code>SSLContext</code>. IBM MQ&rsquo;s CipherSpec is still required.</div>
<pre class="bg-dark text-light p-3 rounded"><code>{
  "type": "ibmmq",
  "description": "IBM MQ with PEM certificates and CipherSpec",
  "connection": {
    "host": "ibmmq-host",
    "port": 1414,
    "queue_manager": "QM_PROD",
    "channel": "DGFACADE.SSL.SVRCONN",
    "username": "dgfacade",
    "password": "secret"
  },
  "ssl": {
    "enabled": true,
    "format": "PEM",
    "protocol": "TLSv1.3",
    "cipher_suite": "TLS_AES_256_GCM_SHA384",
    "ca_cert_path":     "/opt/certs/ibmmq-ca-chain.pem",
    "client_cert_path": "/opt/certs/dgfacade-ibmmq-client.pem",
    "client_key_path":  "/opt/certs/dgfacade-ibmmq-client.key"
  }
}</code></pre>
<p class="text-muted mt-2 small"><strong>Note:</strong> IBM MQ&rsquo;s <code>cipher_suite</code> must match the server-side <code>SSLCIPH</code> attribute on the SVRCONN channel.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ════════════════════ SSL/TLS REFERENCE ════════════════════ -->
                <section id="ssl" class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4"><i class="fas fa-lock me-2 text-danger"></i>SSL / TLS Configuration Reference</h2>
                    <p>All broker types support SSL/TLS. DGFacade&rsquo;s <code>SslHelper</code> supports two certificate formats: traditional JKS/PKCS12 keystores and modern PEM files.</p>

                    <!-- Format selector -->
                    <ul class="nav nav-pills mb-4" role="tablist">
                        <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#ssl-pem-ref"><i class="fas fa-certificate me-1"></i>PEM Format</a></li>
                        <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#ssl-jks-ref"><i class="fas fa-key me-1"></i>JKS / PKCS12 Format</a></li>
                    </ul>
                    <div class="tab-content">
                        <!-- PEM Reference -->
                        <div class="tab-pane fade show active" id="ssl-pem-ref">
                            <div class="alert alert-success"><i class="fas fa-leaf me-2"></i><strong>Recommended for cloud-native deployments.</strong> No keytool conversion. Works directly with cert-manager, Let&rsquo;s Encrypt, AWS ACM, and OpenSSL-generated certificates.</div>
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td><code>enabled</code></td><td>boolean</td><td>Yes</td><td>Must be <code>true</code></td></tr>
                                    <tr><td><code>format</code></td><td>string</td><td>Yes</td><td>Must be <code>"PEM"</code></td></tr>
                                    <tr><td><code>protocol</code></td><td>string</td><td>No</td><td>Default: <code>TLSv1.3</code></td></tr>
                                    <tr><td><code>ca_cert_path</code></td><td>string</td><td><span class="badge bg-danger">Yes</span></td><td>Path to CA certificate / cert chain (<code>.pem</code> or <code>.crt</code>). Multiple certs concatenated.</td></tr>
                                    <tr><td><code>client_cert_path</code></td><td>string</td><td>mTLS only</td><td>Path to client certificate (<code>.pem</code> or <code>.crt</code>). Can include full chain.</td></tr>
                                    <tr><td><code>client_key_path</code></td><td>string</td><td>mTLS only</td><td>Path to client private key (<code>.key</code>). PKCS#8, PKCS#1 RSA, or SEC1 EC.</td></tr>
                                    <tr><td><code>cipher_suite</code></td><td>string</td><td>IBM MQ only</td><td>CipherSpec for IBM MQ SVRCONN channel</td></tr>
                                </tbody>
                            </table>
                            <h6 class="mt-4"><i class="fas fa-terminal me-2"></i>Generating PEM Files with OpenSSL</h6>
<pre class="bg-dark text-light p-3 rounded small"><code># Generate CA key and self-signed cert
openssl genrsa -out ca.key 4096
openssl req -new -x509 -days 3650 -key ca.key -out ca.pem -subj "/CN=DGFacade-CA"

# Generate client key and CSR
openssl genrsa -out client.key 2048
openssl req -new -key client.key -out client.csr -subj "/CN=dgfacade-client"

# Sign client cert with CA (creates cert chain)
openssl x509 -req -days 365 -in client.csr -CA ca.pem -CAkey ca.key \
    -CAcreateserial -out client.crt

# Create full chain (client cert + CA cert concatenated)
cat client.crt ca.pem > client-fullchain.pem

# Verify the chain
openssl verify -CAfile ca.pem client.crt</code></pre>
                        </div>
                        <!-- JKS Reference -->
                        <div class="tab-pane fade" id="ssl-jks-ref">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td><code>enabled</code></td><td>boolean</td><td><code>false</code></td><td>Enable SSL/TLS</td></tr>
                                    <tr><td><code>format</code></td><td>string</td><td><code>JKS</code></td><td><code>JKS</code> or <code>PKCS12</code></td></tr>
                                    <tr><td><code>protocol</code></td><td>string</td><td><code>TLSv1.3</code></td><td>SSL protocol version</td></tr>
                                    <tr><td><code>keystore_path</code></td><td>string</td><td>&mdash;</td><td>Path to Java keystore (client certificate)</td></tr>
                                    <tr><td><code>keystore_password</code></td><td>string</td><td>&mdash;</td><td>Keystore password</td></tr>
                                    <tr><td><code>keystore_type</code></td><td>string</td><td><code>JKS</code></td><td>Keystore format</td></tr>
                                    <tr><td><code>truststore_path</code></td><td>string</td><td>&mdash;</td><td>Path to truststore (CA certificates)</td></tr>
                                    <tr><td><code>truststore_password</code></td><td>string</td><td>&mdash;</td><td>Truststore password</td></tr>
                                    <tr><td><code>truststore_type</code></td><td>string</td><td><code>JKS</code></td><td>Truststore format</td></tr>
                                    <tr><td><code>cipher_suite</code></td><td>string</td><td>&mdash;</td><td>Specific cipher suite (IBM MQ)</td></tr>
                                </tbody>
                            </table>
                            <h6 class="mt-4"><i class="fas fa-terminal me-2"></i>Converting PEM to JKS</h6>
<pre class="bg-dark text-light p-3 rounded small"><code># Import CA cert into truststore
keytool -import -trustcacerts -alias ca -file ca.pem \
    -keystore truststore.jks -storepass changeit -noprompt

# Convert client cert+key to PKCS12, then import to JKS
openssl pkcs12 -export -in client.crt -inkey client.key \
    -out client.p12 -name client -passout pass:changeit
keytool -importkeystore -srckeystore client.p12 -srcstoretype PKCS12 \
    -destkeystore keystore.jks -deststoretype JKS \
    -srcstorepass changeit -deststorepass changeit</code></pre>
                        </div>
                    </div>

                    <div class="alert alert-warning mt-4">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Security Note:</strong> Store passwords securely. Use environment variable substitution
                        (e.g., <code>"keystore_password": "${KAFKA_SSL_PASSWORD}"</code>) or mount secrets from Vault/K8s Secrets in production.
                    </div>
                </section>

                <div class="mt-5 text-center">
                    <a href="/help/architecture" class="btn btn-outline-primary"><i class="fas fa-arrow-left me-2"></i>Architecture</a>
                    <a href="/help" class="btn btn-outline-secondary ms-2"><i class="fas fa-home me-2"></i>Help Index</a>
                    <a href="/help/channels" class="btn btn-primary ms-2">Channel Configuration<i class="fas fa-arrow-right ms-2"></i></a>
                </div>
            </div>
        </div>

        <footer class="py-4 mt-5 border-top">
            <div class="row">
                <div class="col-md-6"><h6><i class="fas fa-network-wired me-2"></i><span th:text="${appName} ?: 'DGFacade'">DGFacade</span></h6><p class="text-muted small mb-0">Version <span th:text="${version} ?: '1.3.0'">1.3.0</span></p></div>
                <div class="col-md-6 text-end"><p class="text-muted small mb-0">Copyright &copy; 2025-2030 Ashutosh Sinha<br><span class="badge bg-warning text-dark">Patent Pending</span></p></div>
            </div>
        </footer>
    </div>
</main>
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>
</body>
</html>
