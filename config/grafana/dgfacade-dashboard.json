{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "Prometheus data source for DGFacade metrics",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "annotations": { "list": [] },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "title": "DGFacade Overview",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false
    },
    {
      "title": "Requests / sec",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "targets": [{ "expr": "rate(dgfacade_requests_total[5m])", "legendFormat": "req/s" }],
      "fieldConfig": { "defaults": { "unit": "reqps", "thresholds": { "steps": [{"color":"green","value":null},{"color":"yellow","value":100},{"color":"red","value":500}] } } }
    },
    {
      "title": "Active Requests",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "targets": [{ "expr": "dgfacade_requests_active", "legendFormat": "active" }],
      "fieldConfig": { "defaults": { "thresholds": { "steps": [{"color":"green","value":null},{"color":"yellow","value":50},{"color":"red","value":200}] } } }
    },
    {
      "title": "Error Rate",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "targets": [{ "expr": "rate(dgfacade_handler_errors_total[5m])", "legendFormat": "errors/s" }],
      "fieldConfig": { "defaults": { "unit": "reqps", "thresholds": { "steps": [{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":10}] } } }
    },
    {
      "title": "Timeout Rate",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "targets": [{ "expr": "rate(dgfacade_handler_timeouts_total[5m])", "legendFormat": "timeouts/s" }],
      "fieldConfig": { "defaults": { "unit": "reqps", "thresholds": { "steps": [{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":1}] } } }
    },
    {
      "title": "Uptime",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "targets": [{ "expr": "dgfacade_uptime_seconds", "legendFormat": "uptime" }],
      "fieldConfig": { "defaults": { "unit": "s" } }
    },
    {
      "title": "Registered Handlers",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "targets": [{ "expr": "dgfacade_handlers_registered", "legendFormat": "handlers" }],
      "fieldConfig": { "defaults": { "thresholds": { "steps": [{"color":"blue","value":null}] } } }
    },
    {
      "title": "Request Throughput by Type",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 5 },
      "targets": [{ "expr": "rate(dgfacade_requests_total{status=\"submitted\"}[5m])", "legendFormat": "{{request_type}}" }],
      "fieldConfig": { "defaults": { "unit": "reqps", "custom": { "drawStyle": "line", "fillOpacity": 20 } } }
    },
    {
      "title": "Handler Execution Duration (p50 / p95 / p99)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 5 },
      "targets": [
        { "expr": "histogram_quantile(0.50, rate(dgfacade_handler_execution_duration_seconds_bucket[5m]))", "legendFormat": "p50" },
        { "expr": "histogram_quantile(0.95, rate(dgfacade_handler_execution_duration_seconds_bucket[5m]))", "legendFormat": "p95" },
        { "expr": "histogram_quantile(0.99, rate(dgfacade_handler_execution_duration_seconds_bucket[5m]))", "legendFormat": "p99" }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "drawStyle": "line", "fillOpacity": 10 } } }
    },
    {
      "title": "Handler Execution",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 13 },
      "collapsed": false
    },
    {
      "title": "Execution Duration by Request Type",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "targets": [{ "expr": "histogram_quantile(0.95, rate(dgfacade_handler_execution_duration_seconds_bucket[5m]))", "legendFormat": "{{request_type}} (p95)" }],
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "drawStyle": "bars", "fillOpacity": 50 } } }
    },
    {
      "title": "Error Breakdown by Type",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 14 },
      "targets": [{ "expr": "increase(dgfacade_handler_errors_total[1h])", "legendFormat": "{{request_type}} - {{error_type}}" }]
    },
    {
      "title": "Timeout Breakdown by Handler",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 14 },
      "targets": [{ "expr": "increase(dgfacade_handler_timeouts_total[1h])", "legendFormat": "{{request_type}}" }]
    },
    {
      "title": "Request Success vs Error Rate",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 22 },
      "targets": [
        { "expr": "rate(dgfacade_requests_total{status=\"success\"}[5m])", "legendFormat": "Success" },
        { "expr": "rate(dgfacade_requests_total{status=\"error\"}[5m])", "legendFormat": "Error" }
      ],
      "fieldConfig": { "defaults": { "unit": "reqps", "custom": { "drawStyle": "line", "fillOpacity": 30 } } }
    },
    {
      "title": "Payload Size Distribution",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 22 },
      "targets": [{ "expr": "dgfacade_handler_execution_payload_size_sum / dgfacade_handler_execution_payload_size_count", "legendFormat": "avg payload {{request_type}}" }],
      "fieldConfig": { "defaults": { "unit": "bytes", "custom": { "drawStyle": "line", "fillOpacity": 15 } } }
    },
    {
      "title": "JVM & System",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 30 },
      "collapsed": false
    },
    {
      "title": "JVM Heap Used",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 31 },
      "targets": [
        { "expr": "jvm_memory_used_bytes{area=\"heap\"}", "legendFormat": "Used" },
        { "expr": "jvm_memory_max_bytes{area=\"heap\"}", "legendFormat": "Max" }
      ],
      "fieldConfig": { "defaults": { "unit": "bytes", "custom": { "drawStyle": "line", "fillOpacity": 20 } } }
    },
    {
      "title": "JVM Thread Count",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 31 },
      "targets": [
        { "expr": "jvm_threads_live_threads", "legendFormat": "Live" },
        { "expr": "jvm_threads_daemon_threads", "legendFormat": "Daemon" },
        { "expr": "jvm_threads_peak_threads", "legendFormat": "Peak" }
      ],
      "fieldConfig": { "defaults": { "custom": { "drawStyle": "line", "fillOpacity": 10 } } }
    },
    {
      "title": "System CPU & Load",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 31 },
      "targets": [
        { "expr": "system_cpu_usage", "legendFormat": "System CPU" },
        { "expr": "process_cpu_usage", "legendFormat": "Process CPU" }
      ],
      "fieldConfig": { "defaults": { "unit": "percentunit", "min": 0, "max": 1, "custom": { "drawStyle": "line", "fillOpacity": 20 } } }
    },
    {
      "title": "HTTP API",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 39 },
      "collapsed": false
    },
    {
      "title": "HTTP Request Rate by Endpoint",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "targets": [{ "expr": "rate(dgfacade_api_http_requests_seconds_count[5m])", "legendFormat": "{{method}} {{uri}}" }],
      "fieldConfig": { "defaults": { "unit": "reqps", "custom": { "drawStyle": "line", "fillOpacity": 20 } } }
    },
    {
      "title": "HTTP Response Latency (p95)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "targets": [{ "expr": "histogram_quantile(0.95, rate(dgfacade_api_http_requests_seconds_bucket[5m]))", "legendFormat": "{{method}} {{uri}} p95" }],
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "drawStyle": "line", "fillOpacity": 10 } } }
    },
    {
      "title": "Infrastructure",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 48 },
      "collapsed": false
    },
    {
      "title": "Users / API Keys / Handlers / Brokers / Channels",
      "type": "stat",
      "gridPos": { "h": 4, "w": 24, "x": 0, "y": 49 },
      "targets": [
        { "expr": "dgfacade_users_active", "legendFormat": "Users" },
        { "expr": "dgfacade_apikeys_total", "legendFormat": "API Keys" },
        { "expr": "dgfacade_handlers_registered", "legendFormat": "Handlers" },
        { "expr": "dgfacade_brokers_configured", "legendFormat": "Brokers" },
        { "expr": "dgfacade_channels_configured", "legendFormat": "Channels" }
      ],
      "fieldConfig": { "defaults": { "thresholds": { "steps": [{"color":"blue","value":null}] } } },
      "options": { "graphMode": "none", "textMode": "value_and_name" }
    }
  ],
  "schemaVersion": 39,
  "tags": ["dgfacade", "prometheus", "handlers"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "DGFacade â€” Handler Metrics Dashboard",
  "uid": "dgfacade-main",
  "version": 1,
  "weekStart": ""
}
